# parseit
Messing around with parser combinators in python. Trees generated by grammars
are slightly optimized and then "compiled" into a custom bytecode that is
interpreted to parse input.

## Arithmetic
A parser that handles simple arithmetic.

```python
from parseit import Char, Forward, LeftParen, Many, Number, RightParen


def op(args):
    ans, rest = args
    for op, arg in rest:
        if op == "+":
            ans += arg
        elif op == "-":
            ans -= arg
        elif op == "*":
            ans *= arg
        elif op == "/":
            ans /= arg
    return ans


expr = Forward()
factor = (Number | (LeftParen >> expr << RightParen))
term = (factor + Many((Char("*") | Char("/")) + factor)).map(op)
expr <= (term + Many((Char("+") | Char("-")) + term)).map(op)
```

```
In [1]: from parseit.arith import expr                                                                                                                                                         

In [2]: expr("2*(3+4)/3+4")[1]                                                                                                                                                                 
Out[2]: 8.666666666666668
```

## Simple json
```python
from parseit import (Colon,
                     Comma,
                     Forward,
                     Keyword,
                     LeftBracket,
                     LeftCurly,
                     Number,
                     RightBracket,
                     RightCurly,
                     QuotedString,
                     WS)


JsonArray = Forward() % "Json Array"
JsonObject = Forward() % "Json Object"
TRUE = Keyword("true", True) % "TRUE"
FALSE = Keyword("false", False) % "FALSE"
NULL = Keyword("null", None) % "NULL"
SimpleValue = (QuotedString | Number | JsonObject | JsonArray | TRUE | FALSE | NULL) % "SimpleValue"
JsonValue = (WS >> SimpleValue << WS) % "Json Value"
Key = (QuotedString << Colon) % "Key"
KVPairs = (((WS >> Key) + JsonValue).sep_by(Comma)) % "KVPairs"
JsonArray <= (LeftBracket >> JsonValue.sep_by(Comma) << RightBracket) % "Json Array"
JsonObject <= (LeftCurly >> KVPairs.map(lambda res: {k: v for (k, v) in res}) << RightCurly) % "Json Object"
```

```
In [1]: from parseit.json_parser import JsonValue

In [2]: JsonValue('{"a": 15, "b": [2, 3, 4], "c": {"ip": "192.168.0.1", "port":
        8080}}')[1]                                                                                                    
Out[2]: {'a': 15, 'b': [2, 3, 4], 'c': {'ip': '192.168.0.1', 'port': 8080}}
```
