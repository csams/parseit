# parseit
Messing around with parser combinators in python. Trees generated by grammars
are slightly optimized and then "compiled" into a custom bytecode which is
interpreted to parse input.

## Arithmetic
A parser that handles simple arithmetic.

```python
from parseit import Char, Forward, Many, Number


def reduce(args):
    ans, rest = args
    for op, arg in rest:
        if op == "+":
            ans += arg
        elif op == "-":
            ans -= arg
        elif op == "*":
            ans *= arg
        elif op == "/":
            ans /= arg
    return ans


expr = Forward()
factor = (Number | (Char("(") >> expr << Char(")")))
term = (factor + Many((Char("*") | Char("/")) + factor)).map(reduce)
expr <= (term + Many((Char("+") | Char("-")) + term)).map(reduce)
```

```
In [1]: from parseit.arith import expr                                                                                                                                                         

In [2]: expr("2*(3+4)/3+4")[1]                                                                                                                                                                 
Out[2]: 8.666666666666668
```

## Simple json
```python
from parseit import (AllWhitespace,
                     Colon,
                     Comma,
                     Forward,
                     Keyword,
                     LeftBracket,
                     LeftCurly,
                     Many,
                     Number,
                     RightBracket,
                     RightCurly,
                     QuotedString)


WS = Many(AllWhitespace)
JsonArray = Forward()
JsonObject = Forward()
TRUE = Keyword("true", True)
FALSE = Keyword("false", False)
NULL = Keyword("null", None)
SimpleValue = (QuotedString | Number | JsonObject | JsonArray | TRUE | FALSE | NULL)
JsonValue = (WS >> SimpleValue << WS)
Key = (QuotedString << Colon)
KVPairs = (((WS >> Key) + JsonValue).sep_by(Comma))
JsonObject <= (LeftCurly >> KVPairs.map(lambda res: {k: v for (k, v) in res}) << RightCurly)
JsonArray <= (LeftBracket >> JsonValue.sep_by(Comma) << RightBracket)
```

```
In [1]: from parseit.json_parser import JsonValue                                                                                                                                              

In [2]: JsonValue('{"a": 15, "b": [2, 3, 4], "c": {"ip": "192.168.0.1", "port":
        8080}}')[1]                                                                                                    
Out[2]: {'a': 15.0, 'b': [2.0, 3.0, 4.0], 'c': {'ip': '192.168.0.1', 'port':
    8080.0}}
```
